# ๐ Diagrama de Fluxo - TrackZone

## Fluxo Principal: Cadastro de Moto

```
โโโโโโโโโโโโโโโ
โ   Usuรกrio   โ
โ  (Browser)  โ
โโโโโโโโฌโโโโโโโ
       โ
       โ 1. Acessa /motos/novo
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  MotoController     โ
โ  novoCadastroMoto() โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 2. Verifica autenticaรงรฃo
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โAuthenticationServiceโ
โ  isAuthenticated()  โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 3. Retorna formulรกrio
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  Template Thymeleaf โ
โ  cadastroMotos.html โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 4. Preenche dados e submete
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  MotoController     โ
โ  salvarMoto()       โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 5. Valida dados
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  MotoService        โ
โ  - placaExiste()    โ
โ  - chassiExiste()   โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 6. Validaรงรตes OK
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  MotoRepository     โ
โ  save()             โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 7. Persiste no banco
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  Oracle/H2 Database โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 8. Retorna sucesso
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  Redirect /motos    โ
โ  ?sucesso=true      โ
โโโโโโโโโโโโโโโโโโโโโโโ
```

## Fluxo: Chat com IA

```
โโโโโโโโโโโโโโโ
โ   Usuรกrio   โ
โ  (Browser)  โ
โโโโโโโโฌโโโโโโโ
       โ
       โ 1. Acessa /ai/chat
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  AIController       โ
โ  chat()             โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 2. Renderiza template
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  Template Thymeleaf โ
โ  ai/chat.html       โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 3. Usuรกrio faz pergunta
       โ    POST /ai/perguntar
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  AIController       โ
โ  perguntar()        โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 4. Verifica se IA disponรญvel
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  AIService          โ
โ  obterSugestao()    โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 5a. Spring AI disponรญvel?
       โ     โโโโโโโโโโโ
       โ     โ   SIM   โ
       โ     โโโโโโฌโโโโโ
       โ          โ
       โ          โผ
       โ     โโโโโโโโโโโโโโโโโโโโโโโ
       โ     โ  Spring AI          โ
       โ     โ  (Ollama/OpenAI)    โ
       โ     โโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โ 5b. Spring AI nรฃo disponรญvel?
       โ     โโโโโโโโโโโ
       โ     โ   NรO   โ
       โ     โโโโโโฌโโโโโ
       โ          โ
       โ          โผ
       โ     โโโโโโโโโโโโโโโโโโโโโโโ
       โ     โ  AIServiceFallback   โ
       โ     โ  obterSugestao()    โ
       โ     โโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โ 6. Retorna resposta
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  JSON Response      โ
โ  {resposta: "..."}  โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 7. Exibe resposta no chat
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  Interface do Chat  โ
โ  (ai/chat.html)     โ
โโโโโโโโโโโโโโโโโโโโโโโ
```

## Fluxo: Autenticaรงรฃo e Autorizaรงรฃo

```
โโโโโโโโโโโโโโโ
โ   Usuรกrio   โ
โ  (Browser)  โ
โโโโโโโโฌโโโโโโโ
       โ
       โ 1. Acessa qualquer rota protegida
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  Spring Security    โ
โ  SecurityFilterChainโ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 2. Verifica se autenticado
       โ    โโโโโโโโโโโ
       โ    โ   NรO   โ
       โ    โโโโโโฌโโโโโ
       โ         โ
       โ         โผ
       โ    โโโโโโโโโโโโโโโโโโโโโโโ
       โ    โ  Redirect /login    โ
       โ    โโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โ 3. Usuรกrio faz login
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  LoginController    โ
โ  login()            โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 4. Valida credenciais
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  UsuarioDetailsServiceโ
โ  loadUserByUsername()โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 5. Busca usuรกrio
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  UsuarioRepository  โ
โ  findByEmail()      โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 6. Verifica senha (BCrypt)
       โ    โโโโโโโโโโโ
       โ    โ   OK    โ
       โ    โโโโโโฌโโโโโ
       โ         โ
       โ         โผ
       โ    โโโโโโโโโโโโโโโโโโโโโโโ
       โ    โ  Cria sessรฃo        โ
       โ    โ  SecurityContext     โ
       โ    โโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โ 7. Verifica perfil (ADMIN/GERENTE/OPERADOR)
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  SegurancaConfig    โ
โ  authorizeRequests()โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 8. Permite acesso conforme perfil
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  Controller         โ
โ  (MotoController,  โ
โ   etc.)             โ
โโโโโโโโโโโโโโโโโโโโโโโ
```

## Fluxo: Atualizaรงรฃo de Status de Moto

```
โโโโโโโโโโโโโโโ
โ   Usuรกrio   โ
โ  (Admin)    โ
โโโโโโโโฌโโโโโโโ
       โ
       โ 1. Acessa /motos/operacoes
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โStatusMotoControllerโ
โ  listarStatusMotos()โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 2. Lista todas as motos e status
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โStatusMotosRepositoryโ
โ  findAll()          โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 3. Usuรกrio seleciona moto e atualiza status
       โ    POST /motos/status/salvar
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โStatusMotoControllerโ
โ  salvarStatusMoto() โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 4. Verifica autenticaรงรฃo
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โAuthenticationServiceโ
โ  getUsuarioLogado() โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 5. Busca moto
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  MotoRepository     โ
โ  findById()         โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 6. Cria novo StatusMoto
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โStatusMotosRepositoryโ
โ  save()             โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 7. Persiste no banco
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  Oracle/H2 Database โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 8. Retorna sucesso
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  Redirect /motos    โ
โ  ?sucesso=true      โ
โโโโโโโโโโโโโโโโโโโโโโโ
```

## Fluxo: Relatรณrio de Status

```
โโโโโโโโโโโโโโโ
โ   Usuรกrio   โ
โ  (Gerente)  โ
โโโโโโโโฌโโโโโโโ
       โ
       โ 1. Acessa /relatorios/status
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โRelatorioController  โ
โ  relatorioStatus()  โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 2. Verifica autenticaรงรฃo
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โAuthenticationServiceโ
โ  isAuthenticated()  โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 3. Busca status
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โStatusMotosRepositoryโ
โ  findAll()          โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 4. Processa dados
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  Template Thymeleaf โ
โ  relatorios/status  โ
โ  .html              โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 5. Renderiza relatรณrio
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  Usuรกrio visualiza  โ
โ  relatรณrio          โ
โโโโโโโโโโโโโโโโโโโโโโโ
```

## Fluxo: Dashboard

```
โโโโโโโโโโโโโโโ
โ   Usuรกrio   โ
โ  (Admin)    โ
โโโโโโโโฌโโโโโโโ
       โ
       โ 1. Acessa /dashboard
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โDashboardController  โ
โ  dashboard()        โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 2. Busca dados
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  MotoRepository     โ
โ  findAll()          โ
โโโโโโโโโโโโโโโโโโโโโโโค
โStatusMotosRepositoryโ
โ  findAll()          โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 3. Calcula estatรญsticas
       โ    - Motos prontas
       โ    - Motos alugadas
       โ    - Motos em manutenรงรฃo
       โ    - etc.
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  Template Thymeleaf โ
โ  home/dashboard.html โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 4. Renderiza dashboard
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  Usuรกrio visualiza  โ
โ  estatรญsticas       โ
โโโโโโโโโโโโโโโโโโโโโโโ
```

## Fluxo de Erro (Exception Handling)

```
โโโโโโโโโโโโโโโโโโโโโโโ
โ  Qualquer Controllerโ
โ  (Mรฉtodo qualquer)  โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 1. Erro ocorre
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  Exception lanรงada  โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 2. Capturada pelo handler
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โGlobalExceptionHandlerโ
โ  handleException()  โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 3. Log do erro
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  Logger (SLF4J)     โ
โ  logger.error()     โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 4. Retorna pรกgina de erro
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  Template Thymeleaf โ
โ  error/500.html     โ
โโโโโโโโโโโโโโโโโโโโโโโ
```

---

**Diagramas criados para demonstrar os principais fluxos do sistema TrackZone**




